(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[522],{1978:(n,e,a)=>{"use strict";let s;a.d(e,{P:()=>h});var o=a(5453),t=a(3464);let u=(n,e)=>({shangping:[],diaodu:!0,gianche:n=>{e().huanchun&&e().chongshi(n)},time:0,wangluo:!0,huanchun:[],chongshi:async a=>{let{huanchun:s}=e(),o=[...s].sort((n,e)=>n.banben-e.banben),u=o.find(n=>!1==n.is);for(let i of(console.log(u),o)){if(!e().diaodu)break;n({diaodu:!1});let o=async()=>{try{await t.A.post("/api/gouwuche?id=".concat(a),{id:u.key,chaozhuo:u.chaozhuo,banben:u.banben}).then(n=>console.log(n.data,"成功",s)),n({huanchun:e().huanchun.filter(n=>n.banben!=u.banben)}),n({diaodu:!0}),e().gianche(a)}catch(s){alert("超时，刷新浏览器试试"),"加"==u.chaozhuo?n(n=>({shangping:n.shangping.map(n=>n.id==u.key?{id:n.id,shu:n.shu-1,banben:n.banben}:n),chong:u})):n(n=>({shangping:n.shangping.map(n=>n.id==u.key?{id:n.id,shu:n.shu+1,banben:n.banben}:n),chong:u})),n({diaodu:!0}),e().gianche(a)}};setTimeout(()=>o(),3e3)}},settongbu:async()=>{let a=e().user;try{let e=await t.A.get("/api/gouwuche?id=".concat(a)).then(n=>n.data);console.log(e),e.ss&&(e.ss.shuju=e.ss.shuju.map(n=>({id:n.id,shu:n.shu,banben:-1})),console.log(e.ss.shuju),n(()=>({shangping:e.ss.shuju})))}catch(n){console.log(n)}},shangpingjia:async a=>{if(!e().wangluo||Date.now()-e().time<500)return;n(n=>{n.time=Date.now();let e=n.shangping.find(n=>n.id==a);return(console.log(e),e)?{shangping:n.shangping.map(n=>n.id==a?{id:a,shu:n.shu+1,banben:n.banben+1}:n)}:{shangping:[...n.shangping,{id:a,shu:1,banben:0}]}});let s=e().user,o=e().shangping.find(n=>n.id==a);try{await t.A.post("/api/gouwuche?id=".concat(s),{id:a,chaozhuo:"加",banben:o.banben}).then(n=>{n.data,console.log(n.data)})}catch(o){if(console.log(o),t.A.isAxiosError(o))if(409==o.request.status){var u,i;alert("超时，稍等"),console.log("版本冲突正在重试",null==(u=o.response)?void 0:u.data);let a=null==(i=o.response)?void 0:i.data;n(n=>({huanchun:[...n.huanchun,{is:!1,key:a.id,banben:a.kehubanben,oldbanben:a.banben,chaozhuo:a.chaozhuo}]})),console.log(e().huanchun),console.log(e().shangping),e().chongshi(s)}else alert("错误请重试"),n(n=>n.shangping.find(n=>n.id===a).shu<=1?{shangping:n.shangping.filter(n=>1!=n.shu)}:{shangping:n.shangping.map(n=>n.id==a?{id:a,shu:n.shu-1,banben:n.banben-1}:n)})}},shangpingjian:async a=>{if(e().shangping.find(n=>n.id==a).shu<=1)return alert("减不了了");if(!e().wangluo||Date.now()-e().time<500)return;n(n=>({shangping:n.shangping.map(n=>n.id==a?{id:a,shu:n.shu-1,banben:n.banben+1}:n)}));let s=e().user,o=e().shangping.find(n=>n.id==a);try{await t.A.post("/api/gouwuche?id=".concat(s),{id:a,chaozhuo:"减",banben:o.banben}).then(n=>{n.data,console.log(n.data)})}catch(o){if(console.log(o),t.A.isAxiosError(o))if(409==o.request.status){var u,i;console.log("版本冲突正在重试",null==(u=o.response)?void 0:u.data);let a=null==(i=o.response)?void 0:i.data;n(n=>({huanchun:[...n.huanchun,{is:!1,key:a.id,banben:a.kehubanben,oldbanben:a.banben,chaozhuo:a.chaozhuo}]})),console.log(e().huanchun),console.log(e().shangping),e().chongshi(s)}else alert("错误请重试"),n(n=>({shangping:n.shangping.map(n=>n.id==a?{id:a,shu:n.shu+1}:n)}))}}}),i=(n,e)=>({user:null,isLoggedIn:!1,log:()=>{n({isLoggedIn:!0}),e().settongbu(),t.A.post("/api/gouwuche?cz=1").then(n=>console.log(n.data))},logout:()=>n({isLoggedIn:!1,user:null}),setuser:e=>n({user:e})}),h=(0,o.v)((s=(n,e)=>({...u(n,e),...i(n,e)}),(n,e,a)=>s(e=>(window.addEventListener("offline",()=>n({wangluo:!1})),window.addEventListener("online",()=>n({wangluo:!0})),n(e)),e,a)))},2834:(n,e,a)=>{Promise.resolve().then(a.bind(a,7217))},5695:(n,e,a)=>{"use strict";var s=a(8999);a.o(s,"useRouter")&&a.d(e,{useRouter:function(){return s.useRouter}})},7217:(n,e,a)=>{"use strict";a.d(e,{default:()=>h});var s=a(5155),o=a(2115),t=a(3464),u=a(1978),i=a(5695);function h(){let[n,e]=(0,o.useState)(""),[a,h]=(0,o.useState)(""),l=(0,u.P)(n=>n.log),g=(0,u.P)(n=>n.setuser),c=(0,i.useRouter)();return(0,s.jsxs)("form",{className:"space-y-4",children:[(0,s.jsx)("input",{type:"text",placeholder:"用户名",value:n,onChange:n=>e(n.target.value),className:"block w-full p-2 border rounded",maxLength:2}),(0,s.jsx)("input",{type:"password",placeholder:"密码",value:a,onChange:n=>h(n.target.value),className:"block w-full p-2 border rounded",maxLength:8}),(0,s.jsx)("button",{type:"submit",className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",onClick:e=>{e.preventDefault(),t.A.post("/api/denglu?id=".concat(n,"&password=").concat(a)).then(n=>{let e=n.data;console.log(e),e?alert("注册成功"):alert("注册失败,已有用户")})},children:"注册"}),(0,s.jsx)("button",{type:"submit",className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",onClick:e=>{e.preventDefault(),t.A.get("/api/denglu?id=".concat(n,"&password=").concat(a)).then(e=>{let a=!!e.data&&g(n);console.log(e.data),!1!=a?(alert("登录成功"),c.back(),l()):alert("登录失败，请重试")})},children:"登录"})]})}}},n=>{var e=e=>n(n.s=e);n.O(0,[604,441,684,358],()=>e(2834)),_N_E=n.O()}]);