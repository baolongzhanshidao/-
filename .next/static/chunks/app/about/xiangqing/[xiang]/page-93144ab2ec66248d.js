(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[697],{1978:(n,a,e)=>{"use strict";let s;e.d(a,{P:()=>g});var i=e(5453),o=e(3464);let u=(n,a)=>({shangping:[],diaodu:!0,gianche:n=>{a().huanchun&&a().chongshi(n)},time:0,wangluo:!0,huanchun:[],chongshi:async e=>{let{huanchun:s}=a(),i=[...s].sort((n,a)=>n.banben-a.banben),u=i.find(n=>!1==n.is);for(let h of(console.log(u),i)){if(!a().diaodu)break;n({diaodu:!1});let i=async()=>{try{await o.A.post("/api/gouwuche?id=".concat(e),{id:u.key,chaozhuo:u.chaozhuo,banben:u.banben}).then(n=>console.log(n.data,"成功",s)),n({huanchun:a().huanchun.filter(n=>n.banben!=u.banben)}),n({diaodu:!0}),a().gianche(e)}catch(s){alert("超时，刷新浏览器试试"),"加"==u.chaozhuo?n(n=>({shangping:n.shangping.map(n=>n.id==u.key?{id:n.id,shu:n.shu-1,banben:n.banben}:n),chong:u})):n(n=>({shangping:n.shangping.map(n=>n.id==u.key?{id:n.id,shu:n.shu+1,banben:n.banben}:n),chong:u})),n({diaodu:!0}),a().gianche(e)}};setTimeout(()=>i(),3e3)}},settongbu:async()=>{let e=a().user;try{let a=await o.A.get("/api/gouwuche?id=".concat(e)).then(n=>n.data);console.log(a),a.ss&&(a.ss.shuju=a.ss.shuju.map(n=>({id:n.id,shu:n.shu,banben:-1})),console.log(a.ss.shuju),n(()=>({shangping:a.ss.shuju})))}catch(n){console.log(n)}},shangpingjia:async e=>{if(!a().wangluo||Date.now()-a().time<500)return;n(n=>{n.time=Date.now();let a=n.shangping.find(n=>n.id==e);return(console.log(a),a)?{shangping:n.shangping.map(n=>n.id==e?{id:e,shu:n.shu+1,banben:n.banben+1}:n)}:{shangping:[...n.shangping,{id:e,shu:1,banben:0}]}});let s=a().user,i=a().shangping.find(n=>n.id==e);try{await o.A.post("/api/gouwuche?id=".concat(s),{id:e,chaozhuo:"加",banben:i.banben}).then(n=>{n.data,console.log(n.data)})}catch(i){if(console.log(i),o.A.isAxiosError(i))if(409==i.request.status){var u,h;alert("超时，稍等"),console.log("版本冲突正在重试",null==(u=i.response)?void 0:u.data);let e=null==(h=i.response)?void 0:h.data;n(n=>({huanchun:[...n.huanchun,{is:!1,key:e.id,banben:e.kehubanben,oldbanben:e.banben,chaozhuo:e.chaozhuo}]})),console.log(a().huanchun),console.log(a().shangping),a().chongshi(s)}else alert("错误请重试"),n(n=>n.shangping.find(n=>n.id===e).shu<=1?{shangping:n.shangping.filter(n=>1!=n.shu)}:{shangping:n.shangping.map(n=>n.id==e?{id:e,shu:n.shu-1,banben:n.banben-1}:n)})}},shangpingjian:async e=>{if(a().shangping.find(n=>n.id==e).shu<=1)return alert("减不了了");if(!a().wangluo||Date.now()-a().time<500)return;n(n=>({shangping:n.shangping.map(n=>n.id==e?{id:e,shu:n.shu-1,banben:n.banben+1}:n)}));let s=a().user,i=a().shangping.find(n=>n.id==e);try{await o.A.post("/api/gouwuche?id=".concat(s),{id:e,chaozhuo:"减",banben:i.banben}).then(n=>{n.data,console.log(n.data)})}catch(i){if(console.log(i),o.A.isAxiosError(i))if(409==i.request.status){var u,h;console.log("版本冲突正在重试",null==(u=i.response)?void 0:u.data);let e=null==(h=i.response)?void 0:h.data;n(n=>({huanchun:[...n.huanchun,{is:!1,key:e.id,banben:e.kehubanben,oldbanben:e.banben,chaozhuo:e.chaozhuo}]})),console.log(a().huanchun),console.log(a().shangping),a().chongshi(s)}else alert("错误请重试"),n(n=>({shangping:n.shangping.map(n=>n.id==e?{id:e,shu:n.shu+1}:n)}))}}}),h=(n,a)=>({user:null,isLoggedIn:!1,log:()=>{n({isLoggedIn:!0}),a().settongbu(),o.A.post("/api/gouwuche?cz=1").then(n=>console.log(n.data))},logout:()=>n({isLoggedIn:!1,user:null}),setuser:a=>n({user:a})}),g=(0,i.v)((s=(n,a)=>({...u(n,a),...h(n,a)}),(n,a,e)=>s(a=>(window.addEventListener("offline",()=>n({wangluo:!1})),window.addEventListener("online",()=>n({wangluo:!0})),n(a)),a,e)))},2110:(n,a,e)=>{"use strict";e.d(a,{default:()=>t});var s=e(5155),i=e(6774),o=e.n(i),u=e(1978),h=e(5695),g=e(2115);function t(n){let{id:a}=n,{user:e,shangpingjia:i,isLoggedIn:t}=(0,u.P)(),[l,c]=(0,g.useState)(!1),d=(0,h.useRouter)();return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:o().zhu,children:[(0,s.jsxs)("div",{className:o().shangping,children:["这是第",a,"号商品"]}),(0,s.jsx)("button",{onClick:()=>{t?i(a):d.push("/about/denglu/")},className:o().jiaru,children:"加入购物车"})]})})}},4873:(n,a,e)=>{Promise.resolve().then(e.bind(e,2110))},5695:(n,a,e)=>{"use strict";var s=e(8999);e.o(s,"useRouter")&&e.d(a,{useRouter:function(){return s.useRouter}})},6774:n=>{n.exports={shangping:"xiang_shangping__sNUQ6",jiaru:"xiang_jiaru__aUzg3",zhu:"xiang_zhu__zZv0f"}}},n=>{var a=a=>n(n.s=a);n.O(0,[347,604,441,684,358],()=>a(4873)),_N_E=n.O()}]);