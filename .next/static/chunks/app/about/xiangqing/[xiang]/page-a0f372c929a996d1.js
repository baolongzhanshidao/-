(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[697],{1978:(n,a,s)=>{"use strict";let e;s.d(a,{P:()=>h});var i=s(5453),o=s(3464);let u=(n,a)=>({shangping:[],time:0,wangluo:!0,huanchun:[],chongshi:async n=>{let{huanchun:s}=a(),e=s.find(n=>!1==n.is);setTimeout(async()=>{e.banben==e.oldbanben-1&&await o.A.post("/api/gouwuche?id=".concat(n),{id:n,chaozhuo:"加",banben:e.banben})},3e3)},settongbu:async()=>{let s=a().user;try{let a=await o.A.get("/api/gouwuche?id=".concat(s)).then(n=>n.data);console.log(a),a.ss&&(a.ss.shuju=a.ss.shuju.map(n=>({id:n.id,shu:n.shu,banben:-1})),console.log(a.ss.shuju),n(()=>({shangping:a.ss.shuju})))}catch(n){console.log(n)}},shangpingjia:async s=>{if(!a().wangluo||Date.now()-a().time<500)return;n(n=>{n.time=Date.now();let a=n.shangping.find(n=>n.id==s);return(console.log(a),a)?{shangping:n.shangping.map(n=>n.id==s?{id:s,shu:n.shu+1,banben:n.banben+1}:n)}:{shangping:[...n.shangping,{id:s,shu:1,banben:0}]}});let e=a().user,i=a().shangping.find(n=>n.id==s);try{await o.A.post("/api/gouwuche?id=".concat(e),{id:s,chaozhuo:"加",banben:i.banben}).then(n=>{n.data,console.log(n.data)})}catch(e){if(console.log(e),o.A.isAxiosError(e)){if(409==e.request.status){var u,t;console.log("版本冲突正在重试",null==(u=e.response)?void 0:u.data);let s=null==(t=e.response)?void 0:t.data;n(n=>({huanchun:n.huanchun.push({is:!1,key:"/api/gouwuche?id=".concat(s.id),banben:i.banben,oldbanben:s.banben,chaozhuo:s.chaozhuo})})),a().chongshi()}}else alert("错误请重试");n(n=>n.shangping.find(n=>n.id===s).shu<=1?{shangping:n.shangping.filter(n=>1!=n.shu)}:{shangping:n.shangping.map(n=>n.id==s?{id:s,shu:n.shu-1}:n)})}},shangpingjian:async s=>{if(a().shangping.find(n=>n.id==s).shu<=1)return alert("减不了了");if(!a().wangluo||Date.now()-a().time<500)return;n(n=>({shangping:n.shangping.map(n=>n.id==s?{id:s,shu:n.shu-1,banben:n.banben+1}:n)}));let e=a().user,i=a().shangping.find(n=>n.id==s);try{await o.A.post("/api/gouwuche?id=".concat(e),{id:s,chaozhuo:"减",banben:i.banben}).then(n=>{n.data,console.log(n.data)})}catch(e){if(console.log(e),o.A.isAxiosError(e)&&409==e.request.status){var u,t;console.log("版本冲突正在重试",null==(u=e.response)?void 0:u.data);let s=null==(t=e.response)?void 0:t.data;n(n=>({huanchun:n.huanchun.push({is:!1,key:"/api/gouwuche?id=".concat(s.id),banben:i.banben,oldbanben:s.banben,chaozhuo:s.chaozhuo})})),a().chongshi()}alert("错误请重试"),n(n=>({shangping:n.shangping.map(n=>n.id==s?{id:s,shu:n.shu+1}:n)}))}}}),t=(n,a)=>({user:null,isLoggedIn:!1,log:()=>{n({isLoggedIn:!0}),a().settongbu(),o.A.post("/api/gouwuche?cz=1").then(n=>console.log(n.data))},logout:()=>n({isLoggedIn:!1,user:null}),setuser:a=>n({user:a})}),h=(0,i.v)((e=(n,a)=>({...u(n,a),...t(n,a)}),(n,a,s)=>e(a=>(window.addEventListener("offline",()=>n({wangluo:!1})),window.addEventListener("online",()=>n({wangluo:!0})),n(a)),a,s)))},2110:(n,a,s)=>{"use strict";s.d(a,{default:()=>g});var e=s(5155),i=s(6774),o=s.n(i),u=s(1978),t=s(5695),h=s(2115);function g(n){let{id:a}=n,{user:s,shangpingjia:i,isLoggedIn:g}=(0,u.P)(),[l,c]=(0,h.useState)(!1),d=(0,t.useRouter)();return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:o().zhu,children:[(0,e.jsxs)("div",{className:o().shangping,children:["这是第",a,"号商品"]}),(0,e.jsx)("button",{onClick:()=>{g?i(a):d.push("/about/denglu/")},className:o().jiaru,children:"加入购物车"})]})})}},4873:(n,a,s)=>{Promise.resolve().then(s.bind(s,2110))},5695:(n,a,s)=>{"use strict";var e=s(8999);s.o(e,"useRouter")&&s.d(a,{useRouter:function(){return e.useRouter}})},6774:n=>{n.exports={shangping:"xiang_shangping__sNUQ6",jiaru:"xiang_jiaru__aUzg3",zhu:"xiang_zhu__zZv0f"}}},n=>{var a=a=>n(n.s=a);n.O(0,[347,604,441,684,358],()=>a(4873)),_N_E=n.O()}]);