(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[697],{1978:(n,s,a)=>{"use strict";let e;a.d(s,{P:()=>g});var i=a(5453),o=a(3464);let u=(n,s)=>({shangping:[],time:0,wangluo:!0,huanchun:[],chongshi:async n=>{let{huanchun:a}=s(),e=[...a].sort((n,s)=>n.banben-s.banben);e.filter(n=>!0!=n.is),console.log(e.find(n=>!1==n.is))},settongbu:async()=>{let a=s().user;try{let s=await o.A.get("/api/gouwuche?id=".concat(a)).then(n=>n.data);console.log(s),s.ss&&(s.ss.shuju=s.ss.shuju.map(n=>({id:n.id,shu:n.shu,banben:-1})),console.log(s.ss.shuju),n(()=>({shangping:s.ss.shuju})))}catch(n){console.log(n)}},shangpingjia:async a=>{if(!s().wangluo||Date.now()-s().time<500)return;n(n=>{n.time=Date.now();let s=n.shangping.find(n=>n.id==a);return(console.log(s),s)?{shangping:n.shangping.map(n=>n.id==a?{id:a,shu:n.shu+1,banben:n.banben+1}:n)}:{shangping:[...n.shangping,{id:a,shu:1,banben:0}]}});let e=s().user,i=s().shangping.find(n=>n.id==a);try{await o.A.post("/api/gouwuche?id=".concat(e),{id:a,chaozhuo:"加",banben:i.banben}).then(n=>{n.data,console.log(n.data)})}catch(g){if(console.log(g),o.A.isAxiosError(g))if(409==g.request.status){var u,h;alert("超时，稍等"),console.log("版本冲突正在重试",null==(u=g.response)?void 0:u.data);let a=null==(h=g.response)?void 0:h.data;n(n=>({huanchun:[...n.huanchun,{is:!1,key:a.id,banben:i.banben,oldbanben:a.banben,chaozhuo:a.chaozhuo}],shangping:n.shangping.map(n=>n.id==a.id?{id:n.id,shu:n.shu,banben:a.banben}:n)})),console.log(s().huanchun),console.log(s().shangping),s().chongshi(e)}else alert("错误请重试"),n(n=>n.shangping.find(n=>n.id===a).shu<=1?{shangping:n.shangping.filter(n=>1!=n.shu)}:{shangping:n.shangping.map(n=>n.id==a?{id:a,shu:n.shu-1,banben:n.banben-1}:n)})}},shangpingjian:async a=>{if(s().shangping.find(n=>n.id==a).shu<=1)return alert("减不了了");if(!s().wangluo||Date.now()-s().time<500)return;n(n=>({shangping:n.shangping.map(n=>n.id==a?{id:a,shu:n.shu-1,banben:n.banben+1}:n)}));let e=s().user,i=s().shangping.find(n=>n.id==a);try{await o.A.post("/api/gouwuche?id=".concat(e),{id:a,chaozhuo:"减",banben:i.banben}).then(n=>{n.data,console.log(n.data)})}catch(g){if(console.log(g),o.A.isAxiosError(g))if(409==g.request.status){var u,h;console.log("版本冲突正在重试",null==(u=g.response)?void 0:u.data);let a=null==(h=g.response)?void 0:h.data;n(n=>({huanchun:[...n.huanchun,{is:!1,key:a.id,banben:i.banben,oldbanben:a.banben,chaozhuo:a.chaozhuo}],shangping:n.shangping.map(n=>n.id==a.id?{id:n.id,shu:n.shu,banben:a.banben}:n)})),console.log(s().huanchun),console.log(s().shangping),s().chongshi(e)}else alert("错误请重试"),n(n=>({shangping:n.shangping.map(n=>n.id==a?{id:a,shu:n.shu+1}:n)}))}}}),h=(n,s)=>({user:null,isLoggedIn:!1,log:()=>{n({isLoggedIn:!0}),s().settongbu(),o.A.post("/api/gouwuche?cz=1").then(n=>console.log(n.data))},logout:()=>n({isLoggedIn:!1,user:null}),setuser:s=>n({user:s})}),g=(0,i.v)((e=(n,s)=>({...u(n,s),...h(n,s)}),(n,s,a)=>e(s=>(window.addEventListener("offline",()=>n({wangluo:!1})),window.addEventListener("online",()=>n({wangluo:!0})),n(s)),s,a)))},2110:(n,s,a)=>{"use strict";a.d(s,{default:()=>t});var e=a(5155),i=a(6774),o=a.n(i),u=a(1978),h=a(5695),g=a(2115);function t(n){let{id:s}=n,{user:a,shangpingjia:i,isLoggedIn:t}=(0,u.P)(),[l,d]=(0,g.useState)(!1),c=(0,h.useRouter)();return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:o().zhu,children:[(0,e.jsxs)("div",{className:o().shangping,children:["这是第",s,"号商品"]}),(0,e.jsx)("button",{onClick:()=>{t?i(s):c.push("/about/denglu/")},className:o().jiaru,children:"加入购物车"})]})})}},4873:(n,s,a)=>{Promise.resolve().then(a.bind(a,2110))},5695:(n,s,a)=>{"use strict";var e=a(8999);a.o(e,"useRouter")&&a.d(s,{useRouter:function(){return e.useRouter}})},6774:n=>{n.exports={shangping:"xiang_shangping__sNUQ6",jiaru:"xiang_jiaru__aUzg3",zhu:"xiang_zhu__zZv0f"}}},n=>{var s=s=>n(n.s=s);n.O(0,[347,604,441,684,358],()=>s(4873)),_N_E=n.O()}]);