(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[876],{1173:n=>{n.exports={zhu:"gouwu_zhu__HVEkn",hao:"gouwu_hao__Dh4LA",zhu1:"gouwu_zhu1__girZy",jiajian:"gouwu_jiajian__yVAHX",zhiti:"gouwu_zhiti__a9Ann",zhiti1:"gouwu_zhiti1__LytNh"}},1925:(n,a,s)=>{"use strict";s.d(a,{default:()=>u});var i=s(5155),e=s(1173),h=s.n(e),o=s(1978);function u(){let n=(0,o.P)(n=>n.shangping),a=(0,o.P)(n=>n.shangpingjia),s=(0,o.P)(n=>n.shangpingjian),e=n=>{a(n)},u=n=>{s(n)};return(0,i.jsx)(i.Fragment,{children:n.map(n=>(0,i.jsx)("div",{children:(0,i.jsxs)("div",{className:h().zhu1,children:[(0,i.jsxs)("span",{className:h().zhu,children:["欢迎",(0,i.jsx)("br",{}),"光临"]}),(0,i.jsxs)("span",{className:h().hao,children:[" 这是",n.id,"号商品"]}),(0,i.jsxs)("span",{className:h().jiajian,children:[(0,i.jsx)("button",{className:h().zhiti,onClick:()=>e(n.id),children:"+"}),(0,i.jsx)("p",{className:h().zhiti,children:n.shu}),(0,i.jsx)("button",{className:h().zhiti1,onClick:()=>u(n.id),children:"-"})]})]})},n.id))})}},1978:(n,a,s)=>{"use strict";let i;s.d(a,{P:()=>t});var e=s(5453),h=s(3464);let o=(n,a)=>({shangping:[],time:0,wangluo:!0,huanchun:[],chongshi:async n=>{let{huanchun:s}=a(),i=s.find(n=>!1==n.is);setTimeout(async()=>{i.banben==i.oldbanben-1&&await h.A.post("/api/gouwuche?id=".concat(n),{id:n,chaozhuo:"加",banben:i.banben})},3e3)},settongbu:async()=>{let s=a().user;try{let a=await h.A.get("/api/gouwuche?id=".concat(s)).then(n=>n.data);console.log(a),a.ss&&(a.ss.shuju=a.ss.shuju.map(n=>({id:n.id,shu:n.shu,banben:-1})),console.log(a.ss.shuju),n(()=>({shangping:a.ss.shuju})))}catch(n){console.log(n)}},shangpingjia:async s=>{if(!a().wangluo||Date.now()-a().time<500)return;n(n=>{n.time=Date.now();let a=n.shangping.find(n=>n.id==s);return(console.log(a),a)?{shangping:n.shangping.map(n=>n.id==s?{id:s,shu:n.shu+1,banben:n.banben+1}:n)}:{shangping:[...n.shangping,{id:s,shu:1,banben:0}]}});let i=a().user,e=a().shangping.find(n=>n.id==s);try{await h.A.post("/api/gouwuche?id=".concat(i),{id:s,chaozhuo:"加",banben:e.banben}).then(n=>{n.data,console.log(n.data)})}catch(i){if(console.log(i),h.A.isAxiosError(i)){if(409==i.request.status){var o,u;console.log("版本冲突正在重试",null==(o=i.response)?void 0:o.data);let s=null==(u=i.response)?void 0:u.data;n(n=>({huanchun:n.huanchun.push({is:!1,key:"/api/gouwuche?id=".concat(s.id),banben:e.banben,oldbanben:s.banben,chaozhuo:s.chaozhuo})})),a().chongshi()}}else alert("错误请重试");n(n=>n.shangping.find(n=>n.id===s).shu<=1?{shangping:n.shangping.filter(n=>1!=n.shu)}:{shangping:n.shangping.map(n=>n.id==s?{id:s,shu:n.shu-1}:n)})}},shangpingjian:async s=>{if(a().shangping.find(n=>n.id==s).shu<=1)return alert("减不了了");if(!a().wangluo||Date.now()-a().time<500)return;n(n=>({shangping:n.shangping.map(n=>n.id==s?{id:s,shu:n.shu-1,banben:n.banben+1}:n)}));let i=a().user,e=a().shangping.find(n=>n.id==s);try{await h.A.post("/api/gouwuche?id=".concat(i),{id:s,chaozhuo:"减",banben:e.banben}).then(n=>{n.data,console.log(n.data)})}catch(i){if(console.log(i),h.A.isAxiosError(i)&&409==i.request.status){var o,u;console.log("版本冲突正在重试",null==(o=i.response)?void 0:o.data);let s=null==(u=i.response)?void 0:u.data;n(n=>({huanchun:n.huanchun.push({is:!1,key:"/api/gouwuche?id=".concat(s.id),banben:e.banben,oldbanben:s.banben,chaozhuo:s.chaozhuo})})),a().chongshi()}alert("错误请重试"),n(n=>({shangping:n.shangping.map(n=>n.id==s?{id:s,shu:n.shu+1}:n)}))}}}),u=(n,a)=>({user:null,isLoggedIn:!1,log:()=>{n({isLoggedIn:!0}),a().settongbu(),h.A.post("/api/gouwuche?cz=1").then(n=>console.log(n.data))},logout:()=>n({isLoggedIn:!1,user:null}),setuser:a=>n({user:a})}),t=(0,e.v)((i=(n,a)=>({...o(n,a),...u(n,a)}),(n,a,s)=>i(a=>(window.addEventListener("offline",()=>n({wangluo:!1})),window.addEventListener("online",()=>n({wangluo:!0})),n(a)),a,s)))},9442:(n,a,s)=>{Promise.resolve().then(s.bind(s,1925))}},n=>{var a=a=>n(n.s=a);n.O(0,[638,604,441,684,358],()=>a(9442)),_N_E=n.O()}]);