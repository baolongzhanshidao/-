(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[876],{1173:n=>{n.exports={zhu:"gouwu_zhu__HVEkn",hao:"gouwu_hao__Dh4LA",zhu1:"gouwu_zhu1__girZy",jiajian:"gouwu_jiajian__yVAHX",zhiti:"gouwu_zhiti__a9Ann",zhiti1:"gouwu_zhiti1__LytNh"}},1925:(n,a,s)=>{"use strict";s.d(a,{default:()=>u});var e=s(5155),i=s(1173),h=s.n(i),o=s(1978);function u(){let n=(0,o.P)(n=>n.shangping),a=(0,o.P)(n=>n.shangpingjia),s=(0,o.P)(n=>n.shangpingjian),i=n=>{a(n)},u=n=>{s(n)};return(0,e.jsx)(e.Fragment,{children:n.map(n=>(0,e.jsx)("div",{children:(0,e.jsxs)("div",{className:h().zhu1,children:[(0,e.jsxs)("span",{className:h().zhu,children:["欢迎",(0,e.jsx)("br",{}),"光临"]}),(0,e.jsxs)("span",{className:h().hao,children:[" 这是",n.id,"号商品"]}),(0,e.jsxs)("span",{className:h().jiajian,children:[(0,e.jsx)("button",{className:h().zhiti,onClick:()=>i(n.id),children:"+"}),(0,e.jsx)("p",{className:h().zhiti,children:n.shu}),(0,e.jsx)("button",{className:h().zhiti1,onClick:()=>u(n.id),children:"-"})]})]})},n.id))})}},1978:(n,a,s)=>{"use strict";let e;s.d(a,{P:()=>g});var i=s(5453),h=s(3464);let o=(n,a)=>({shangping:[],diaodu:!0,gianche:n=>{a().huanchun&&a().chongshi(n)},time:0,wangluo:!0,huanchun:[],chongshi:async s=>{let{huanchun:e}=a(),i=[...e].sort((n,a)=>n.banben-a.banben),o=i.find(n=>!1==n.is);for(let u of(console.log(o),i)){if(!a().diaodu)break;n({diaodu:!1});let i=async()=>{try{await h.A.post("/api/gouwuche?id=".concat(s),{id:o.key,chaozhuo:o.chaozhuo,banben:o.banben}).then(n=>console.log(n.data,"成功",e)),n({huanchun:a().huanchun.filter(n=>n.banben!=o.banben)}),n({diaodu:!0}),a().gianche(s)}catch(e){alert("超时，刷新浏览器试试"),"加"==o.chaozhuo?n(n=>({shangping:n.shangping.map(n=>n.id==o.key?{id:n.id,shu:n.shu-1,banben:n.banben}:n),chong:o})):n(n=>({shangping:n.shangping.map(n=>n.id==o.key?{id:n.id,shu:n.shu+1,banben:n.banben}:n),chong:o})),n({diaodu:!0}),a().gianche(s)}};setTimeout(()=>i(),3e3)}},settongbu:async()=>{let s=a().user;try{let a=await h.A.get("/api/gouwuche?id=".concat(s)).then(n=>n.data);console.log(a),a.ss&&(a.ss.shuju=a.ss.shuju.map(n=>({id:n.id,shu:n.shu,banben:-1})),console.log(a.ss.shuju),n(()=>({shangping:a.ss.shuju})))}catch(n){console.log(n)}},shangpingjia:async s=>{if(!a().wangluo||Date.now()-a().time<500)return;n(n=>{n.time=Date.now();let a=n.shangping.find(n=>n.id==s);return(console.log(a),a)?{shangping:n.shangping.map(n=>n.id==s?{id:s,shu:n.shu+1,banben:n.banben+1}:n)}:{shangping:[...n.shangping,{id:s,shu:1,banben:0}]}});let e=a().user,i=a().shangping.find(n=>n.id==s);try{await h.A.post("/api/gouwuche?id=".concat(e),{id:s,chaozhuo:"加",banben:i.banben}).then(n=>{n.data,console.log(n.data)})}catch(i){if(console.log(i),h.A.isAxiosError(i))if(409==i.request.status){var o,u;alert("超时，稍等"),console.log("版本冲突正在重试",null==(o=i.response)?void 0:o.data);let s=null==(u=i.response)?void 0:u.data;n(n=>({huanchun:[...n.huanchun,{is:!1,key:s.id,banben:s.kehubanben,oldbanben:s.banben,chaozhuo:s.chaozhuo}]})),console.log(a().huanchun),console.log(a().shangping),a().chongshi(e)}else alert("错误请重试"),n(n=>n.shangping.find(n=>n.id===s).shu<=1?{shangping:n.shangping.filter(n=>1!=n.shu)}:{shangping:n.shangping.map(n=>n.id==s?{id:s,shu:n.shu-1,banben:n.banben-1}:n)})}},shangpingjian:async s=>{if(a().shangping.find(n=>n.id==s).shu<=1)return alert("减不了了");if(!a().wangluo||Date.now()-a().time<500)return;n(n=>({shangping:n.shangping.map(n=>n.id==s?{id:s,shu:n.shu-1,banben:n.banben+1}:n)}));let e=a().user,i=a().shangping.find(n=>n.id==s);try{await h.A.post("/api/gouwuche?id=".concat(e),{id:s,chaozhuo:"减",banben:i.banben}).then(n=>{n.data,console.log(n.data)})}catch(i){if(console.log(i),h.A.isAxiosError(i))if(409==i.request.status){var o,u;console.log("版本冲突正在重试",null==(o=i.response)?void 0:o.data);let s=null==(u=i.response)?void 0:u.data;n(n=>({huanchun:[...n.huanchun,{is:!1,key:s.id,banben:s.kehubanben,oldbanben:s.banben,chaozhuo:s.chaozhuo}]})),console.log(a().huanchun),console.log(a().shangping),a().chongshi(e)}else alert("错误请重试"),n(n=>({shangping:n.shangping.map(n=>n.id==s?{id:s,shu:n.shu+1}:n)}))}}}),u=(n,a)=>({user:null,isLoggedIn:!1,log:()=>{n({isLoggedIn:!0}),a().settongbu(),h.A.post("/api/gouwuche?cz=1").then(n=>console.log(n.data))},logout:()=>n({isLoggedIn:!1,user:null}),setuser:a=>n({user:a})}),g=(0,i.v)((e=(n,a)=>({...o(n,a),...u(n,a)}),(n,a,s)=>e(a=>(window.addEventListener("offline",()=>n({wangluo:!1})),window.addEventListener("online",()=>n({wangluo:!0})),n(a)),a,s)))},9442:(n,a,s)=>{Promise.resolve().then(s.bind(s,1925))}},n=>{var a=a=>n(n.s=a);n.O(0,[638,604,441,684,358],()=>a(9442)),_N_E=n.O()}]);